<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Events</title>
  <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
  <style>
    body {
      margin: 0;
    }

    .loader-overlay {
        position: fixed;
        inset: 0;
        background-color: rgba(255, 255, 255, 0.8);
        backdrop-filter: blur(5px);
        z-index: 200;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .loader {
        border: 8px solid #f3f3f3;
        border-top: 8px solid #f97316;
        border-radius: 50%;
        width: 60px;
        height: 60px;
        animation: spin 1.5s linear infinite;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    .tab-button {
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease-in-out;
      background-color: rgba(255 255 255 / 0.7);
      backdrop-filter: blur(10px);
      border-radius: 0.75rem;
      padding: 0 1rem;
      font-size: 1rem;
      color: #333;
      display: flex;
      align-items: center;
      user-select: none;
      white-space: nowrap;
      height: 2.25rem;
      min-width: 110px;
      justify-content: center;
    }

    .tab-button:hover {
      background-color: #ffb866;
      color: white;
    }

    .tab-active {
      background-color: #ffb866 !important;
      color: white !important;
    }

    #content-all .event-tab,
    #content-completed .event-tab {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.75rem 1rem;
      border-radius: 0.75rem;
      background-color: rgba(255, 255, 255, 0.5);
      transition: background-color 0.2s ease-in-out;
      width: 100%;
      font-weight: 500;
      color: inherit;
      cursor: pointer;
      margin-bottom: 0.3rem;
    }

    #content-all .event-tab:hover,
    #content-completed .event-tab:hover {
      background-color: #ffb866;
      color: white;
    }

    #content-all .event-status,
    #content-completed .event-status {
      background-color: #fff6eb;
      color: #ea580c;
      font-size: 0.85rem;
      padding: 0.25rem 0.6rem;
      border-radius: 0.5rem;
      font-weight: 500;
      white-space: nowrap;
      margin-left: 0.5rem;
    }

    .category-block {
      margin-bottom: 2rem;
    }

    .category-title {
      font-weight: 700;
      font-size: 1.25rem;
      color: #ea580c;
      margin-bottom: 0.75rem;
      border-bottom: 2px solid #f97316;
      padding-bottom: 0.25rem;
      user-select: none;
    }

    .event-tab {
      display: flex;
      flex-direction: column;
      padding: 0.75rem 1rem;
      border-radius: 0.75rem;
      background-color: rgba(255, 255, 255, 0.5);
      transition: background-color 0.2s ease-in-out;
      width: 100%;
      font-weight: 500;
      color: inherit;
      cursor: pointer;
      margin-bottom: 0.5rem;
    }

    .event-tab:hover {
      background-color: #ffb866;
      color: white;
    }

    .event-main-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      width: 100%;
    }

    .event-info {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      flex-wrap: wrap;
      white-space: nowrap;
      font-weight: 600;
    }

    .event-status {
      background-color: #fff6eb;
      color: #ea580c;
      font-size: 0.85rem;
      padding: 0.25rem 0.6rem;
      border-radius: 0.5rem;
      font-weight: 500;
      white-space: nowrap;
      margin-left: 0.5rem;
    }

    .event-venue {
      color: #555;
      font-size: 0.875rem;
      margin-left: 0.5rem;
    }

    .manage-dropdown {
      background-color: rgba(255 255 255 / 0.85);
      padding: 1rem;
      border-radius: 0 0 0.75rem 0.75rem;
      margin-top: 0.75rem;
      box-shadow: 0 2px 6px rgb(0 0 0 / 0.1);
      animation: fadeInDropdown 0.3s ease forwards;
    }

    @keyframes fadeInDropdown {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .manage-dropdown label {
      display: block;
      font-weight: 600;
      margin-bottom: 0.25rem;
      color: #ea580c;
    }

    .manage-dropdown input,
    .manage-dropdown select,
    .manage-dropdown textarea {
      width: 100%;
      padding: 0.4rem 0.5rem;
      border: 1px solid #f97316;
      border-radius: 0.375rem;
      margin-bottom: 0.75rem;
      font-weight: 500;
      font-size: 1rem;
      color: black;
    }

    .manage-dropdown button {
      background-color: #f97316;
      color: white;
      font-weight: 600;
      padding: 0.5rem 1rem;
      border: none;
      border-radius: 0.5rem;
      cursor: pointer;
      transition: background-color 0.2s ease-in-out;
    }

    .manage-dropdown button:hover {
      background-color: #ea580c;
    }

    .theme-bg {
      background-image: linear-gradient(to bottom right, #facc15, #f97316, #ef4444);
    }

    #main-tabs-container {
      position: fixed; top: 1rem; right: 1rem;
      background: rgba(255 255 255 / 0.75);
      backdrop-filter: blur(12px);
      padding: 0.25rem 0.5rem;
      border-radius: 1rem;
      box-shadow: 0 4px 15px rgb(0 0 0 / 0.12);
      display: flex; align-items: center; gap: 0.75rem;
      z-index: 100; user-select: none; min-width: max-content;
    }

    #user-icon-btn {
      width: 38px; height: 38px; border-radius: 0.75rem;
      background-color: rgba(255 255 255 / 0.9);
      display: flex; justify-content: center; align-items: center;
      cursor: pointer; box-shadow: 0 1px 6px rgb(0 0 0 / 0.1);
      transition: background-color 0.2s ease-in-out; position: relative;
      min-width: 2.25rem; min-height: 2.25rem;
    }
    #user-icon-btn:hover { background-color: #ffb866; }
    #user-icon-btn svg {
      width: 22px; height: 22px; stroke: #f97316;
      transition: stroke 0.2s ease-in-out;
    }
    #user-icon-btn:hover svg { stroke: white; }

    #logout-dropdown {
      position: absolute; top: 48px; right: 0;
      background: white; border-radius: 0.5rem;
      box-shadow: 0 4px 15px rgb(0 0 0 / 0.15);
      padding: 0.5rem 1rem; font-weight: 600; color: #f97316;
      cursor: pointer; white-space: nowrap; display: none;
      user-select: none; min-width: 80px; z-index: 101;
      transition: opacity 0.2s ease-in-out;
    }
    #logout-dropdown.show { display: block; }
    
    /* Custom Alert Modal Styles */
    .custom-alert-overlay {
        position: fixed;
        inset: 0;
        background-color: rgba(0, 0, 0, 0.5);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 250;
    }

    .custom-alert-box {
        background-color: white;
        padding: 2rem;
        border-radius: 0.75rem;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        max-width: 400px;
        width: 90%;
        text-align: center;
    }

    .custom-alert-box h3 {
        font-size: 1.25rem;
        font-weight: 700;
        color: #f97316;
        margin-bottom: 1rem;
    }

    .custom-alert-box p {
        color: #333;
        margin-bottom: 1.5rem;
    }

    .custom-alert-box button {
        background-color: #f97316;
        color: white;
        font-weight: 600;
        padding: 0.5rem 1.5rem;
        border-radius: 0.5rem;
        border: none;
        cursor: pointer;
    }
  </style>
</head>

<body class="min-h-screen theme-bg font-sans text-gray-800 transition-colors duration-300">
  <div id="loader-overlay" class="loader-overlay">
    <div class="loader"></div>
  </div>

  <!-- Custom Alert Modal HTML -->
  <div id="custom-alert-overlay" class="custom-alert-overlay">
    <div class="custom-alert-box">
      <h3 id="custom-alert-title"></h3>
      <p id="custom-alert-message"></p>
      <button onclick="hideCustomAlert()">OK</button>
    </div>
  </div>

  <header class="p-4 flex justify-between items-center">
    <div class="flex items-center">
      <!-- Changed logo size to be consistent with previous designs -->
      <img src="GetImage1-removebg-preview.png" alt="Zync Logo" class="h-16" />
    </div>
    <div id="main-tabs-container">
      <button id="tab-manage" onclick="showTab('manage')" class="tab-button">Manage Events</button>
      <button id="tab-all" onclick="showTab('all')" class="tab-button">All Events</button>
      <button id="tab-completed" onclick="showTab('completed')" class="tab-button">Completed Events</button>
      <div id="user-icon-btn" tabindex="0" title="User menu">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round"
            d="M5.121 17.804A9 9 0 0112 15a9 9 0 016.879 2.804M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
        </svg>
        <div id="logout-dropdown">Logout</div>
      </div>
    </div>
  </header>

  <main class="pt-28 px-6">
    <div
      class="max-w-7xl mx-auto bg-white/70 backdrop-blur-sm rounded-xl p-12 shadow min-h-[calc(100vh-9rem)] transition-all">

      <div id="content-all" class="tab-content hidden">
        <h2 class="text-2xl font-bold text-orange-600 mb-4">Upcoming Events</h2>
        <div id="all-events-list" class="flex flex-col gap-3"></div>
      </div>
      
      <div id="content-completed" class="tab-content hidden">
        <h2 class="text-2xl font-bold text-orange-600 mb-4">Completed Events</h2>
        <div id="completed-events-list" class="flex flex-col gap-3"></div>
      </div>

      <div id="content-manage" class="tab-content hidden">
        <div class="flex justify-between items-center mb-6 gap-3 flex-wrap">
          <h2 class="text-2xl font-bold text-orange-600 flex-grow">Manage All Events</h2>
          <div class="flex gap-3">
            <button
              class="bg-orange-500 text-white px-4 py-2 rounded hover:bg-orange-600 font-semibold transition"
              onclick="showTab('add')">+ Add Event</button>
          </div>
        </div>
        <div id="manage-event-list"></div>
      </div>

      <div id="content-add" class="tab-content hidden max-w-md mx-auto">
        <div class="mb-6 flex justify-between items-center">
          <h2 class="text-2xl font-bold text-orange-600">Add New Event</h2>
          <button onclick="showTab('manage')" class="text-orange-500 font-semibold hover:underline">← Back</button>
        </div>
        <form id="addEventForm" class="space-y-4" onsubmit="submitEventForm(event)">
          <div>
            <label class="block font-semibold mb-1 text-orange-600" for="eventName">Event Name</label>
            <input type="text" id="eventName" required class="w-full p-2 border rounded" />
          </div>
          <div>
            <label class="block font-semibold mb-1 text-orange-600" for="eventDate">Event Date</label>
            <input type="date" id="eventDate" required class="w-full p-2 border rounded" />
          </div>
          <div>
            <label class="block font-semibold mb-1 text-orange-600" for="eventVenue">Venue</label>
            <input type="text" id="eventVenue" required class="w-full p-2 border rounded" />
          </div>
          <div>
            <label class="block font-semibold mb-1 text-orange-600" for="eventDescription">Description</label>
            <textarea id="eventDescription" required class="w-full p-2 border rounded" rows="3"></textarea>
          </div>
          <div>
            <label class="block font-semibold mb-1 text-orange-600" for="eventType">Category</label>
            <select id="eventType" required class="w-full p-2 border rounded">
            </select>
          </div>
          <button id="addEventSubmitBtn" type="submit"
            class="bg-orange-500 text-white px-4 py-2 rounded hover:bg-orange-600 font-semibold transition disabled:bg-gray-400">Submit</button>
        </form>
      </div>
    </div>
  </main>

  <footer class="text-center text-sm text-white mt-12 p-4">
    © 2025 All rights reserved.
  </footer>

  <script>
    const userIconBtn = document.getElementById('user-icon-btn');
    const logoutDropdown = document.getElementById('logout-dropdown');
    
    // --- Custom Alert Modal Functions ---
    const customAlertOverlay = document.getElementById('custom-alert-overlay');
    const customAlertTitle = document.getElementById('custom-alert-title');
    const customAlertMessage = document.getElementById('custom-alert-message');

    function showCustomAlert(title, message) {
        customAlertTitle.textContent = title;
        customAlertMessage.textContent = message;
        customAlertOverlay.style.display = 'flex';
    }

    function hideCustomAlert() {
        customAlertOverlay.style.display = 'none';
    }

    userIconBtn.addEventListener('click', e => {
      e.stopPropagation();
      logoutDropdown.classList.toggle('show');
    });

    document.addEventListener('click', () => {
      logoutDropdown.classList.remove('show');
    });

    userIconBtn.addEventListener('keydown', e => {
      if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        userIconBtn.click();
      } else if (e.key === 'Escape') {
        logoutDropdown.classList.remove('show');
      }
    });

    // Modified logout functionality to redirect to login.html
    logoutDropdown.addEventListener('click', () => {
      window.location.href = 'signup.html';
    });
    
    // --- Global State ---
    let events = [];
    const PREDEFINED_CATEGORIES = ['sports', 'cultural', 'tech'];
    let nextEventId = 7;
    const todayString = new Date().toISOString().split('T')[0];

    // --- API Simulation ---
    async function fetchInitialDataAPI() {
      const request = await fetch("api/event/get", {});
      const response = await request.json();  // ✅ Await the JSON parsing
      // Now you can safely access .data
      const mockApiData = response.data
      console.log(mockApiData);
      return mockApiData

        // console.log("--- Simulating GET Request ---");
        // console.log("Endpoint: /api/events");
        // await new Promise(resolve => setTimeout(resolve, 1500)); 

        // const mockApiData = [
        //     { id: 4, name: 'Football Tournament', date: '2024-06-20', venue: 'Stadium', type: 'Sports', description: 'Inter-department football championship.' },
        //     { id: 5, name: 'Music Fest', date: '2024-07-25', venue: 'Auditorium', type: 'Cultural', description: 'A day of live music.' },
        //     { id: 1, name: 'Game Development Jam', date: '2024-06-30', venue: 'Online', type: 'Tech', description: 'A 48-hour jam to create innovative games.' },
        //     { id: 2, name: 'Web3 Hack', date: '2025-08-15', venue: 'Main Hall', type: 'Tech', description: 'Build the future of the decentralized web.' },
        //     { id: 3, name: 'Hackathon', date: '2025-09-01', venue: 'Innovation Hub', type: 'Tech', description: 'The annual flagship hackathon event.' },
        //     { id: 6, name: 'AI Bootcamp', date: '2025-08-05', venue: 'Tech Park', type: 'Tech', description: 'A week-long intensive AI bootcamp.' },
        // ];
        
        // console.log("Response:", mockApiData);
        // console.log("--- Simulation End ---");
        // return mockApiData;
    }
    
    async function addEventAPI(eventData) {
        console.log("Payload:", JSON.stringify(eventData, null, 2));
        const request  = await fetch("/admin/api/event/create",{
          method:"POST",
          headers:{
            'Content-Type':"application/json"
          },
          body:JSON.stringify(eventData, null, 2)
          
        })
        const result = await request.json()
        console.log("Result : ",result)
        
        // ❌ MISSING RETURN STATEMENT!
        // Add this line:
        return result.data || result;
    }

    // --- Rendering Functions ---
    function formatDate(dateStr) {
      if (!dateStr) return '';
      const d = new Date(dateStr);
      if (isNaN(d)) return dateStr;
      return d.toLocaleDateString(undefined, { year: 'numeric', month: 'short', day: 'numeric', timeZone: 'UTC' });
    }

    function createEventElement(eventObj) {
        const eventDiv = document.createElement('div');
        eventDiv.className = 'event-tab';
        eventDiv.setAttribute('data-event-id', eventObj.id);
        eventDiv.onclick = (e) => toggleEventDetails(e, eventObj.id);

        const mainRow = document.createElement('div');
        mainRow.className = 'event-main-row';

        const eventInfo = document.createElement('div');
        eventInfo.className = 'event-info';
        const nameSpan = document.createElement('span');
        nameSpan.className = 'event-name';
        nameSpan.textContent = eventObj.name;
        const dateSpan = document.createElement('span');
        dateSpan.className = 'event-status';
        dateSpan.textContent = formatDate(eventObj.date) || 'Date TBA';
        const venueSpan = document.createElement('span');
        venueSpan.className = 'event-venue';
        venueSpan.textContent = `Venue: ${eventObj.venue || 'TBA'}`;
        eventInfo.append(nameSpan, dateSpan, venueSpan);
        mainRow.appendChild(eventInfo);
        eventDiv.appendChild(mainRow);

        const dropdown = document.createElement('div');
        dropdown.className = 'manage-dropdown';
        dropdown.id = `manage-dropdown-${eventObj.id}`;
        dropdown.style.display = 'none';
        dropdown.onclick = e => e.stopPropagation();

        dropdown.innerHTML = `
            <div id="info-view-${eventObj.id}">
              <p class="font-bold text-orange-600 mb-1">Description:</p>
              <p class="text-gray-700 mb-4">${eventObj.description || 'No description provided.'}</p>
              <button class="edit-btn bg-orange-500 text-white px-4 py-2 rounded hover:bg-orange-600 font-semibold transition">Edit Event</button>
            </div>
            <div id="form-view-${eventObj.id}" style="display: none;">
                <form class="edit-form">
                  <label>Name:</label>
                  <input type="text" name="name" value="${eventObj.name}" required>
                  <label>Date:</label>
                  <input type="date" name="date" value="${eventObj.date}" min="${todayString}" required>
                  <label>Venue:</label>
                  <input type="text" name="venue" value="${eventObj.venue}" required>
                  <label>Description:</label>
                  <textarea name="description" rows="3" required>${eventObj.description}</textarea>
                  <label>Category:</label>
                  <select name="type" required></select>
                  <div class="flex gap-2">
                      <button type="submit">Save</button>
                      <button type="button" class="cancel-btn bg-gray-200 text-gray-800 font-semibold py-2 px-4 rounded hover:bg-gray-300 transition">Cancel</button>
                  </div>
                </form>
            </div>
        `;
        
        const categorySelect = dropdown.querySelector('select[name="type"]');
        PREDEFINED_CATEGORIES.forEach(catName => {
            const opt = document.createElement('option');
            opt.value = catName;
            opt.textContent = catName;
            if (catName === eventObj.type) opt.selected = true;
            categorySelect.appendChild(opt);
        });

        dropdown.querySelector('.edit-btn').onclick = () => switchDropdownView(eventObj.id, 'form');
        dropdown.querySelector('.cancel-btn').onclick = () => switchDropdownView(eventObj.id, 'info');
        dropdown.querySelector('.edit-form').onsubmit = (evt) => {
            evt.preventDefault();
            saveEventChanges(eventObj.id);
        };

        eventDiv.appendChild(dropdown);
        return eventDiv;
    }

    function renderManageEvents() {
        const container = document.getElementById('manage-event-list');
        container.innerHTML = '';

        PREDEFINED_CATEGORIES.forEach(categoryName => {
            const categoryEvents = events.filter(event => event.type === categoryName);
            
            const catBlock = document.createElement('div');
            catBlock.className = 'category-block';

            const catTitle = document.createElement('h3');
            catTitle.className = 'category-title';
            catTitle.textContent = categoryName;
            catBlock.appendChild(catTitle);

            if (categoryEvents.length > 0) {
                categoryEvents.forEach(eventObj => {
                    catBlock.appendChild(createEventElement(eventObj));
                });
            } else {
                const noEventsText = document.createElement('p');
                noEventsText.textContent = 'No events in this category.';
                noEventsText.className = 'text-gray-600 italic ml-2';
                catBlock.appendChild(noEventsText);
            }
            container.appendChild(catBlock);
        });
    }

    function renderSimpleEventList(containerId, eventList) {
        const container = document.getElementById(containerId);
        container.innerHTML = '';
        if (eventList.length === 0) {
            container.innerHTML = '<p class="text-gray-600">No events found.</p>';
            return;
        }
        eventList.forEach(eventObj => {
            const div = document.createElement('div');
            div.className = 'event-tab';
            div.textContent = `${eventObj.name} `;
            const spanDate = document.createElement('span');
            spanDate.className = 'event-status';
            spanDate.textContent = formatDate(eventObj.date) || 'Date TBA';
            div.appendChild(spanDate);
            container.appendChild(div);
        });
    }

    function renderAllEvents() {
      const upcomingEvents = events.filter(e => !e.date || e.date >= todayString);
      renderSimpleEventList('all-events-list', upcomingEvents);
    }
    
    function renderCompletedEvents() {
        const completedEvents = events.filter(e => e.date && e.date < todayString);
        renderSimpleEventList('completed-events-list', completedEvents);
    }

    // --- UI Interaction and Event Handlers ---
    function showTab(tab) {
      ['all', 'manage', 'add', 'completed'].forEach(t => {
        document.getElementById(`content-${t}`).classList.add('hidden');
        document.getElementById(`tab-${t}`)?.classList.remove('tab-active');
      });
      document.getElementById(`content-${tab}`).classList.remove('hidden');
      const tabBtn = document.getElementById(`tab-${tab}`);
      if (tabBtn) tabBtn.classList.add('tab-active');

      if (tab === 'add') {
          const select = document.getElementById('eventType');
          select.innerHTML = '';
          PREDEFINED_CATEGORIES.forEach(catName => {
              select.innerHTML += `<option value="${catName}">${catName}</option>`;
          });
          document.getElementById('eventDate').min = todayString;
      } else if (tab === 'manage') renderManageEvents();
      else if (tab === 'all') renderAllEvents();
      else if (tab === 'completed') renderCompletedEvents();
    }
    
    function switchDropdownView(eventId, view) {
      document.getElementById(`info-view-${eventId}`).style.display = view === 'info' ? 'block' : 'none';
      document.getElementById(`form-view-${eventId}`).style.display = view === 'form' ? 'block' : 'none';
    }

    async function submitEventForm(event) {
        event.preventDefault();
        const submitBtn = document.getElementById('addEventSubmitBtn');
        submitBtn.disabled = true;
        submitBtn.textContent = 'Submitting...';

        const eventData = {
            name: document.getElementById('eventName').value.trim(),
            date: document.getElementById('eventDate').value,
            venue: document.getElementById('eventVenue').value.trim(),
            description: document.getElementById('eventDescription').value.trim(),
            type: document.getElementById('eventType').value
        };

        if (Object.values(eventData).some(val => !val)) {
            showCustomAlert('Error', 'Please fill all fields.');
            submitBtn.disabled = false;
            submitBtn.textContent = 'Submit';
            return;
        }
      
        try {
            const newEvent = await addEventAPI(eventData);
            events.push(newEvent);
            document.getElementById('addEventForm').reset();
            showTab('manage');
        } catch (error) {
            console.error("Failed to add event:", error);
            showCustomAlert('Error', 'There was an error. Please try again.');
        } finally {
            submitBtn.disabled = false;
            submitBtn.textContent = 'Submit';
        }
    }

    function toggleEventDetails(e, eventId) {
      if (e.target.closest('button, form, input, select, textarea, a')) return;
      const dropdown = document.getElementById(`manage-dropdown-${eventId}`);
      if (!dropdown) return;
      const isVisible = dropdown.style.display === 'block';
      document.querySelectorAll('.manage-dropdown').forEach(d => {
        d.style.display = 'none';
      });
      if (!isVisible) {
        switchDropdownView(eventId, 'info');
        dropdown.style.display = 'block';
      }
    }

    function saveEventChanges(eventId) {
        const form = document.querySelector(`#form-view-${eventId} form`);
        const newName = form.elements.name.value.trim();
        const newDate = form.elements.date.value;
        const newVenue = form.elements.venue.value.trim();
        const newDescription = form.elements.description.value.trim();
        const newType = form.elements.type.value;

        if (!newName || !newDate || !newVenue || !newDescription || !newType) {
            showCustomAlert('Error', 'All fields are required.');
            return;
        }
        
        const eventIndex = events.findIndex(e => e.id === eventId);
        if (eventIndex === -1) return;

        events[eventIndex] = { ...events[eventIndex], name: newName, date: newDate, venue: newVenue, description: newDescription, type: newType };
        showCustomAlert('Success', 'Event updated successfully.');
        renderManageEvents(); 
    }
    
    // --- App Initialization ---
    async function initializeApp() {
        const loader = document.getElementById('loader-overlay');
        try {
            events = await fetchInitialDataAPI();
            showTab('manage'); 
            document.getElementById('tab-manage').classList.add('tab-active');
        } catch (error) {
            console.error("Failed to initialize app:", error);
            document.querySelector('main > div').innerHTML = '<p class="text-center text-red-500 font-bold">Failed to load event data. Please refresh the page.</p>';
        } finally {
            loader.style.display = 'none';
        }
    }

    document.addEventListener('DOMContentLoaded', initializeApp);
  </script>
</body>
</html>